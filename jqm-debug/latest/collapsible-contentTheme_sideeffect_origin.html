<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Collapsible: contentTheme side-effect</title>
	<link rel="stylesheet" href="http://code.jquery.com/mobile/git/jquery.mobile-git.css">
	<script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
	<script src="jquery.mobile-git_bugfix_collapsible_default_plus_theme_plus_collapsibleset.js"></script>
</head>
<body>
<div data-role="page">
<div data-role="content" class="jqm-content">

	<h2>Collapsible: Side effect after applying the bugfix about the default values</h2>

	<div id="target" data-role="collapsible" data-collapsed="false">
		<h3>Header</h3>
		<p>Collapsible contents</p>
	</div>
	<span id="result"></span><br/>
	<span id="subresult"></span><br/>

	<hr />
	<a href="javascript:printOption( 'contentTheme', null );">1. Get the default value</a><br/>
	<a href="javascript:setOption( 'contentTheme', 'b' );">1. Set the contentTheme with &quot;b&quot;</a><br/>

	<script>
		function printOption( key, value ) {
			var target = $( "#target" ),
				val = getOption( target, key ),
				result = $( "#result" ),
				el = target.find( ".ui-collapsible-content" ),
				classes = el.attr( "class" ).split( " " ),
				classNames = getClasses( classes, key );

			result.html( key + ": <font color='" + getResultColor( getOptionResult( key, val, value ) ) + "'>" + val + "</font>" );
			result.append( ", class: <font color='" + getResultColor( getClassResult( classNames, key, value ) ) + "'>(" + classNames + ")</font>" );

			if ( classNames.length !== 1 ) {
				$( "#subresult" ).html( "<font color='red'>==&gt; The old class is not removed.</font>" );
			} else if ( !RegExp( value ).test( classNames[0] ) ) {
				$( "#subresult" ).html( "<font color='red'>==&gt; The option value is not applied.</font>" );
			}			
		}

		function setOption( key, value ) {
			var target = $( "#target" );
			target.collapsibleset( "option", key, value );

			var val = getOption( target, key ),
				result = $( "#result" ),
				el = target.find( ".ui-collapsible-content" ),
				classes = el.attr( "class" ).split( " " ),
				classNames = getClasses( classes, key );

			result.html( key + ": <font color='" + getResultColor( getOptionResult( key, val, value ) ) + "'>" + val + "</font>" );
			result.append( ", class: <font color='" + getResultColor( getClassResult( classNames, key, value ) ) + "'>(" + classNames + ")</font>" );

			if ( classNames.length !== 1 ) {
				$( "#subresult" ).html( "<font color='red'>==&gt; The old class is not removed.</font>" );
			} else if ( !RegExp( value ).test( classNames[0] ) ) {
				$( "#subresult" ).html( "<font color='red'>==&gt; The option value is not applied.</font>" );
			}
		}

		function getOption( target, option ) {
			return target.collapsible( "option", option );
		}

		function getClasses( classes, key, value ) {
			var result = [],
				pattern = new RegExp( "ui-body-" ),
				i;

			for ( i in classes ) {
				if ( pattern.test( classes[ i ] ) ) {
					result.push( classes[ i ] );
				}
			}

			return result;
		}

		function getResultColor( result ) {
			return result ? "blue" : "red";
		}

		function getOptionResult( key, value, check ) {
			return value === check;
		}

		function getClassResult( classes, key, value ) {
			if ( classes.length !== 1 ) {
				return false;
			}

			return classes[0] === "ui-body-" + value;
		}
	</script>

</div><!-- /content -->
</div><!-- /page -->
</body>
</html>